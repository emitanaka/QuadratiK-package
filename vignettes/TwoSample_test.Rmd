---
title: "Non-parametric Two-sample test"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Non-parametric Two-sample test}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

### Non-parametric two-sample test
```{r srr-tags, eval = FALSE, echo = FALSE}
#' srr tags
#' 
#' 
#' @srrstats {G1.5} two-sample test example in the associated paper
```
The quadratic distance between two probability distributions $F$ and $G$ is
defined as:

$$
d_{K}(F,G) = \int\int K(x,y) d(F-G)(x) d(F-G)(y),
$$

where $G$ is a distribution whose goodness of fit we wish to assess, and $K$ denotes the Normal kernel defined as:

$$
K(\mathbf{s}, \mathbf{t}) = (2 \pi)^{-d/2} 
\left(\det{\mathbf{\Sigma}_h}\right)^{-\frac{1}{2}}  
\exp\left\{-\frac{1}{2}(\mathbf{s} - \mathbf{t})^\top 
\mathbf{\Sigma}_h^{-1}(\mathbf{s} - \mathbf{t})\right\},
$$

for every $\mathbf{s}, \mathbf{t} \in \mathbb{R}^d \times 
\mathbb{R}^d$, with covariance matrix $\mathbf{\Sigma}_h = h^2 I$ and
tuning parameter.

Let $x_1, x_2, \ldots, x_{n_1} \sim F$ and 
$y_1, y_2, \ldots, y_{n_2} \sim G$ be
random samples from the distributions $F$ and $G$, respectively.
We test the null hypothesis that the two samples are generated from 
the same distribution, that is:

$$
H_0: F = G
$$

vs

$$
H_1: F \not = G.
$$

We generate the samples $x = (x_1, \ldots,x_n)$ from a standard normal distribution $N_d(0,I_d)$ and $y = (y_1, \ldots,y_n)$ from a skew-normal distribution $SN_d(0,I_d, \lambda)$, where $d=4$, $n=100$ and $\lambda= (0.5,\ldots,0.5)$.  
```{r setup, include=FALSE} 
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
```

```{r message=FALSE}
library(sn)
library(mvtnorm)
library(QuadratiK)
n <- 100
d <- 4
skewness_y <- 0.5
set.seed(2468)
x_2 <- rmvnorm(n, mean = rep(0,d))
y_2 <- rmsn(n=n, xi=0, Omega = diag(d), alpha=rep(skewness_y,d))
```
The two-sample test can be performed by providing the two samples to be compared as ``x`` and ``y`` to the ``kb.test()`` function. If a value of $h$ is not provided, the function automatically performs the function ``select_h``. 
```{r }
set.seed(2468)
two_test <- kb.test(x=x_2, y=y_2)
two_test
```
We can display the chosen *optimal* value of $h$ together with the power plot obtained versus the considered $h$, for the alternatives $\delta$ in the ``select_h()`` function.

```{r, fig.width=6, fig.height=4}
two_test@h$h_sel
two_test@h$power.plot
```

For the two-sample case, the ``summary`` function provides the results from the test and the descriptive statistics per variable and per group. Additionally, it generates the qq-plots comparing the quantiles of the two groups for each variable. 
```{r, fig.width=6, fig.height=8}
summary_two <- summary(two_test)
```

```{r}
summary_two$summary_tables
```

The figure automatically generated by the ``summary`` function on the result of the two-sample test displays the qq-plots between the two samples with a table of the standard descriptive statistics for each variable, computed per group and overall.

#### Select h

The search for the *optimal* value of the tuning parameter $h$ can be performed independently from the test computation using the ``select_h`` function. It requires the two samples, provided as ``x`` and ``y``, and the considered family of alternatives. 
```{r, eval=FALSE}
two_test_h <- select_h(x=x_2, y=y_2, alternative = "skewness")
```
The code is not evaluated since we would obtain the same results. 

#### Note

Notice that the test statistics for two-sample testing coincide with the $k$-sample test statistics when $k=2$. Hence, alternatively the two sample tests can be performed providing the two samples together as ``x`` and indicating the membership to the groups with the argument ``y``.
```{r }
x_pool <- rbind(x_2,y_2)
y_memb <- rep(c(1,2),each=n)
h <- two_test@h$h_sel
set.seed(2468)
kb.test(x=x_pool, y=y_memb, h=h)
```
See the *k-sample test* vignette for more details.

## References

Markatou Marianthi & Saraceno Giovanni (2024). “A Unified Framework for 
Multivariate Two- and k-Sample Kernel-based Quadratic Distance 
Goodness-of-Fit Tests.”  
[https://doi.org/10.48550/arXiv.2407.16374](https://doi.org/10.48550/arXiv.2407.16374)
